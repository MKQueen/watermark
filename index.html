<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera with Watermark</title>
    <style>
        #camera {
            text-align: center;
        }
        #captureBtn {
            margin-top: 20px;
        }
        #output {
            margin-top: 20px;
        }
        #output img {
            max-width: 100%; /* 图片最大宽度为页面宽度的100% */
            max-height: 300px; /* 图片最大高度为300像素 */
        }

    </style>
</head>
<body>
<div id="camera">
    <button id="captureBtn">Capture Photo</button>
</div>
<div id="output"></div>
<script>
    const captureButton = document.getElementById('captureBtn');
    const output = document.getElementById('output');

    // 当capture按钮被点击时
    captureButton.addEventListener('click', () => {
        // 创建一个input元素，用于选择图片文件
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*'; // 只接受图片文件
        input.capture = 'camera'; // 打开摄像头
        input.addEventListener('change', () => {
            const file = input.files[0]; // 获取选择的文件

            // 创建一个FileReader对象，用于读取文件
            const reader = new FileReader();
            reader.onload = () => {
                // 创建一个Image对象，用于加载照片
                const photo = new Image();
                photo.src = reader.result;

                // 当照片加载完成时
                photo.onload = () => {
                    // 创建一个Canvas元素，用于添加水印
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = photo.width;
                    canvas.height = photo.height;

                    // 绘制照片到Canvas上
                    ctx.drawImage(photo, 0, 0);
                    // 获取当前时间
                    const currentTime = new Date().toLocaleString();
                    // 添加水印
                    ctx.font = '50px Arial';
                    ctx.fillStyle = 'white';
                    ctx.fillStyle = 'red';
                    ctx.fillText('坚锐智链', 10, canvas.height - 10);

                    ctx.fillText(currentTime, 10, canvas.height - 80); // 当前时间


                    // 将Canvas转换为blob对象
                    canvas.toBlob(blob => {
                        const url = URL.createObjectURL(blob); // 创建一个本地URL
                        const image = new Image();
                        image.src = url;

                        // 将带水印的照片显示在output容器中
                        output.innerHTML = '';
                        output.appendChild(image);
                    }, 'image/jpeg', 0.9); // 保存为jpeg格式，质量为0.9
                };
            };

            if (file) {
                reader.readAsDataURL(file); // 读取文件
            }
        });

        input.click(); // 模拟点击input元素
    });
</script>
</body>
</html>
